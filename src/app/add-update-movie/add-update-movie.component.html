<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ isEditing ? 'Editar Pel√≠cula' : 'Nueva Pel√≠cula' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="form-container">
  <div *ngIf="isLoading && isEditing" class="loading-container">
    <p>Cargando pel√≠cula... ‚è≥</p>
  </div>

  <div *ngIf="!isLoading || !isEditing">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          {{ isEditing ? 'Editar informaci√≥n de la pel√≠cula' : 'Agregar nueva pel√≠cula' }}
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <form (ngSubmit)="saveMovie()" class="form-inputs">
          <ion-item>
            <ion-label position="stacked">T√≠tulo *</ion-label>
            <ion-input
              [(ngModel)]="movieForm.title"
              name="title"
              placeholder="Ingresa el t√≠tulo de la pel√≠cula"
              [disabled]="isLoading"
              maxlength="100">
            </ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Descripci√≥n *</ion-label>
            <ion-textarea
              [(ngModel)]="movieForm.description"
              name="description"
              placeholder="Describe la pel√≠cula"
              rows="4"
              [disabled]="isLoading"
              maxlength="500">
            </ion-textarea>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">URL de imagen</ion-label>
            <ion-input
              [(ngModel)]="movieForm.imageUrl"
              name="imageUrl"
              placeholder="https://ejemplo.com/imagen.jpg"
              [disabled]="isLoading">
            </ion-input>
          </ion-item>

          <div *ngIf="movieForm.imageUrl.trim()" class="image-preview-container">
            <div class="preview-title">
              <h3>Vista previa:</h3>
            </div>
            <div class="preview-wrapper">
              <ion-img 
                [src]="movieForm.imageUrl" 
                [alt]="movieForm.title"
                class="preview-image">
              </ion-img>
              <div class="preview-overlay">
                üì∑ {{ movieForm.title || 'Imagen de la pel√≠cula' }}
              </div>
            </div>
          </div>

          <div class="action-buttons">
            <ion-button 
              expand="block" 
              type="submit"
              class="primary-btn"
              [disabled]="isLoading || !movieForm.title.trim() || !movieForm.description.trim()">
              <span *ngIf="isLoading">‚è≥ Guardando...</span>
              <span *ngIf="!isLoading">{{ isEditing ? 'üíæ Actualizar Pel√≠cula' : 'üíæ Guardar Pel√≠cula' }}</span>
            </ion-button>
            
            <ion-button 
              *ngIf="isEditing"
              expand="block" 
              fill="outline" 
              class="danger-btn"
              (click)="deleteMovie()" 
              [disabled]="isLoading">
              üóëÔ∏è Eliminar pel√≠cula
            </ion-button>
            
            <ion-button 
              expand="block" 
              fill="outline" 
              class="secondary-btn"
              (click)="goBack()" 
              [disabled]="isLoading">
              ‚Üê Volver al inicio
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>